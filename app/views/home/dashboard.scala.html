@import connectors.exchange.AllocationDetails
@import helpers.DateFormatter._
@import models.ApplicationData.ApplicationStatus._
@import models.ApplicationData.ProgressStatuses._
@import models.ApplicationData.ProgressStatuses.ProgressStatus._
@import models.page.DashboardPage.activateByStep
@import models.page.DashboardPage.Flags._
@import models.page.Phase1TestsPage
@import models.page.Phase1TestPage
@import models.page._
@import security.QuestionnaireRoles._
@import security.Roles._
@import security.RoleUtils._
@import views.html.widgets.onlineTestProgress

@(usr: CachedData, dashboardPage: DashboardPage, allocationDetails: Option[AllocationDetails] = None)(implicit request: Request[_], flash: Flash, user: Option[CachedData], feedbackUrl: String)

@renderProgressElement(showLink: Boolean, checked: Boolean, id: String)(link: Call)(body: Html) = {
    <li id="@id"><i id="@id-icon" class='fa @if(checked) { fa-check } else {fa-minus} the-icon'></i> @if(showLink) {
        <a id="@id-link" href="@link">@body</a>
    } else {
        @body
    }
    </li>
}

@main_template(title = "Home") {

    <div class="hgroup">
        <h1 class="heading-xlarge">Home</h1>
        <p class="subtitle">@dashboardPage.fullName</p>
    </div>
    <section class="section-border">
        <ol class="step-by-step-coloured" id="sixSteps">
            <li class="first-step @activateByStep(dashboardPage.firstStepVisibility)">
                <div class="grid-wrapper">
                    <div class="grid grid-2-3">
                        <div class="inner-block-padr">
                            <h2 class='@if(dashboardPage.isApplicationCreatedOrInProgress) {heading-large} else {heading-medium} '>
                                1. Fill in your application form</h2>
                            @if(!dashboardPage.isApplicationWithdrawn) {
                                <ul class="list-text list-withicons">
                                    @if(dashboardPage.isApplicationSubmittedAndNotWithdrawn) {
                                        <li><i class='fa fa-check the-icon'></i>Your application has been submitted</li>
                                    }
                                    @if(dashboardPage.isApplicationInProgressAndNotWithdrawn) {
                                        @renderProgressElement(showLink = EditPersonalDetailsAndContinueRole.isAuthorized(usr), checked = SchemesRole.isAuthorized(usr), "personalDetailsStep")(routes.PersonalDetailsController.presentAndContinue()) {Add personal details }
                                        @renderProgressElement(showLink = SchemesRole.isAuthorized(usr), checked = PartnerGraduateProgrammesRole.isAuthorized(usr), "schemesStep")(routes.SchemePreferencesController.present()) { Choose locations and schemes }
                                        @renderProgressElement(showLink = PartnerGraduateProgrammesRole.isAuthorized(usr), checked = AssistanceDetailsRole.isAuthorized(usr), "partnerGraduateProgrammesStep")(routes.PartnerGraduateProgrammesController.present()) { Partner graduate programmes }
                                        @renderProgressElement(showLink = AssistanceDetailsRole.isAuthorized(usr), checked = hasAssistanceDetails(usr), "assistanceDetailsStep")(routes.AssistanceDetailsController.present()) { Tell us about any assistance needs you may have }
                                        @renderProgressElement(showLink = QuestionnaireInProgressRole.isAuthorized(usr), checked = PreviewApplicationRole.isAuthorized(usr), "questionnaireStep")(routes.QuestionnaireController.presentStartOrContinue()) { Fill in the diversity questions }
                                        @renderProgressElement(showLink = PreviewApplicationRole.isAuthorized(usr), checked = SubmitApplicationRole.isAuthorized(usr), "previewStep")(routes.PreviewApplicationController.present()) { Check your application }
                                        @renderProgressElement(showLink = SubmitApplicationRole.isAuthorized(usr), checked = WithdrawApplicationRole.isAuthorized(usr), "submitStep")(routes.SubmitApplicationController.present()) { Submit }
                                    }
                                </ul>
                            }
                            @if(dashboardPage.isApplicationSubmittedAndNotWithdrawn) {
                                <p><a class="" id="view-application" href="@routes.PreviewApplicationController.present()">View your submitted application</a></p>
                                <p><a class="" id="edit-personal-details" href="@routes.PersonalDetailsController.present()">Edit your personal details</a></p>
                            }

                            @if(dashboardPage.isApplicationWithdrawn) {
                                <a class="" id="view-withdrawn-application" href="@routes.PreviewApplicationController.present()">
                                 View your withdrawn application</a>
                            }

                            @if(dashboardPage.isApplicationCreatedOrInProgress) {
                                <a class="" id="continue-application" href="@routes.HomeController.resume()">
                                    Continue with your application</a>
                            }

                            @if(dashboardPage.isUserWithNoApplication) {
                                <a class="button" id="start-application" href="@routes.HomeController.create()">
                                    Start your application</a>
                            }

                        </div>
                    </div>
                    <div class="grid grid-1-3">
                    </div>
                </div>
            </li>
            <li class="second-step @activateByStep(dashboardPage.secondStepVisibility)">
                <div class="grid-wrapper">
                    <div class="grid grid-2-3">
                        <div class="inner-block-padr">
                            <h2 class="heading-medium">2. Take the online tests</h2>
                        @onlineTestProgress(usr, dashboardPage.phase1TestsPage,
                                    PHASE1_TESTS, PHASE1_TESTS_INVITED, allocationDetails)
                        </div>
                    </div>
                    <div class="grid grid-1-3">
                    </div>
                </div>
            </li>
            <li class="third-step @activateByStep(dashboardPage.secondStepVisibility)">
                <div class="grid-wrapper">
                    <div class="grid grid-2-3">
                        <div class="inner-block-padr">
                            <h2 class="heading-medium ">3. Attend an assessment centre</h2>
                            <p data-hidesdip>If you pass the online tests, you'll be invited to attend an
                                assessment centre.</p>
                            <p data-sdip>Once we've verified your certificate number, you'll be invited
                                to attend an assessment centre.</p>
                            <p><a href="https://www.gov.uk/guidance/civil-service-fast-stream-how-to-apply#analytical-fast-stream-assessment"
                                  rel="external" target="_blank">Find out more about the assessment day</a></p>
                        </div>
                    </div>
                    <div class="grid grid-1-3">
                    </div>
                </div>
            </li>
            <li class="fourth-step @activateByStep(dashboardPage.secondStepVisibility)">
                <div class="grid-wrapper">
                    <div class="grid grid-2-3">
                        <div class="inner-block-padr">
                            <h2 class="heading-medium ">4. Final stages</h2>
                            <p>We aim to let you know the outcome of your assessment by December
                                2016.</p>
                            <p><a href="https://www.gov.uk/guidance/civil-service-fast-stream-how-to-apply#after-your-assessment"
                                  rel="external" target="_blank">Find out more about what happens after you've been accepted for the Fast Stream</a></p>
                        </div>
                    </div>
                    <div class="grid grid-1-3">
                    </div>
                </div>
            </li>
        </ol>
    </section>

    @if(WithdrawComponent.isAuthorized(usr)) {
        <section>
            <h2 class="heading-medium">Withdraw application</h2>
            <div class="text">
                <p>If you no longer wish to proceed with your application you can withdraw
                    at any time.</p>
                <a id="withdraw-app" href="@routes.HomeController.presentWithDraw()">Withdraw application</a>
            </div>
        </section>
    }

}
